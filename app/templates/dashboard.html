<!DOCTYPE html>
<html>
<head>
    <title>Patient Dashboard - TeleHealth Connect</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <style>
        body { font-family: Arial, sans-serif; margin: 30px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
        th { background-color: #f2f2f2; }
        button { padding: 5px 10px; cursor: pointer; }

        /* Flash message styles */
        .flash-message { 
            padding: 10px; 
            margin-bottom: 20px; 
            border-radius: 5px; 
            opacity: 1;
            transition: opacity 1s ease-out;
        }
        .flash-success { background-color: #d4edda; color: #155724; }
        .flash-danger { background-color: #f8d7da; color: #721c24; }
        .flash-info { background-color: #cce5ff; color: #004085; }
    </style>
</head>
<body>
    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="flash-message flash-{{ category }}">
            {{ message }}
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <h1>Welcome, {{ current_user.name }}!</h1>
    <p>Here are the available doctors:</p>
    <p>
        <a href="{{ url_for('patient.my_appointments') }}">View My Appointments</a>
    </p>

    <table>
        <tr>
            <th>Name</th>
            <th>Specialty</th>
            <th>Book Appointment</th>
        </tr>
        {% for doctor in doctors %}
        <tr>
            <td>{{ doctor.name }}</td>
            <td>{{ doctor.specialty }}</td>
            <td>
                <form action="{{ url_for('patient.book_appointment', doctor_id=doctor.id) }}" method="POST">
                    <input type="datetime-local" name="appointment_date" required>
                    <button type="submit">Book</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </table>
    <table>
    <tr>
        <th>Doctor</th>
        <th>Specialty</th>
        <th>Date & Time</th>
        <th>Notes</th>
        <th>Action</th>
    </tr>
    {% for appt in appointments %}
    <tr>
        <td>{{ appt.doctor.name }}</td>
        <td>{{ appt.doctor.specialty }}</td>
        <td>{{ appt.date.strftime('%Y-%m-%d %H:%M') }}</td>
        <td>{{ appt.notes or 'N/A' }}</td>
        <td>
            <form action="{{ url_for('patient.cancel_appointment', appointment_id=appt.id) }}" method="POST" onsubmit="return confirm('Are you sure you want to cancel this appointment?');">
                <button type="submit" style="background-color:#dc3545;color:white;border:none;padding:5px 10px;border-radius:4px;cursor:pointer;">Cancel</button>
            </form>
        </td>
    </tr>
    {% endfor %}
</table>

    <p><a href="{{ url_for('auth.logout') }}">Logout</a></p>

    <script>
        // Auto-hide flash messages after 4 seconds
        window.addEventListener('DOMContentLoaded', () => {
            const flashes = document.querySelectorAll('.flash-message');
            flashes.forEach(flash => {
                setTimeout(() => {
                    flash.style.opacity = '0';
                    setTimeout(() => flash.remove(), 1000);
                }, 4000); // 4 seconds
            });
        });
    </script>
</body>
</html>
